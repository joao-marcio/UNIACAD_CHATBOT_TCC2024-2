<div id="chatBOT">
    <button class="open-button" onclick="openForm()">Chat</button>
    <div id="chat-popup">
        <button type="button" class="btn cancel" onclick="closeForm()">X</button>
        <div class="chat-container" id="chat-window">
            <div class="chat-header">
                <h1>Descomplica da TI: Uniacademia ChatBot</h1>
            </div>
            <div class="chat-messages"><div class="chat-message bot-message">Olá ! Sou seu ChatBot da Uniacademia, qual sua dúvida ?</div></div>
            <div class="chat-message">
                <div class="typing" id="typing-bubble">
                    <span class="circle scaling"></span>
                    <span class="circle scaling"></span>
                    <span class="circle scaling"></span>
                </div>
            </div>
            <div class="chat-input">
              <input type="text" id="input" placeholder="Digite sua mensagem...">
              <button onclick="sendMessage()">Enviar</button>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // old
        function sendData() { 
            document.getElementById('output').innerHTML = "PENSANO...";
            var value = document.getElementById('input').value; 
            $.ajax({ 
                url: 'http://192.168.1.111:5000/process', 
                type: 'POST', 
                contentType: 'application/json', 
                data: JSON.stringify({ 'value': value }), 
                success: function(response) { 
                    document.getElementById('output').innerHTML = response.result; 
                }, 
                error: function(error) { 
                    document.getElementById('output').innerHTML = "NÃO ENTENDI";
                    console.log(error); 
                } 
            }); 
        };
        // new
        function openForm() {
        document.getElementById("chat-popup").style.display = "block";
        };
        function closeForm() {
        document.getElementById("chat-popup").style.display = "none";
        };
        function sendMessage() {
            var message = document.getElementById("input").value;
            if (message !== "") {
                document.getElementById("typing-bubble").style.display = "flex";
                var userMessage = document.createElement("div");
                userMessage.classList.add("chat-message", "user-message");
                userMessage.textContent = message;
                document.querySelector(".chat-messages").appendChild(userMessage);
                let element = document.getElementsByClassName("chat-messages")[0];
                element.scrollTop = element.scrollHeight;
                $.ajax({
                    url: 'http://192.168.1.111:5000/process',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ 'value': message }),
                    success: function(response) {
                        document.getElementById("typing-bubble").style.display = "none";
                        displayReponseText(response.result);
                    },
                    error: function(error) {
                        document.getElementById("typing-bubble").style.display = "none";
                        console.log(error);
                        var errorMessage = document.createElement("div");
                        errorMessage.classList.add("chat-message", "bot-message");
                        errorMessage.textContent = "Erro: Não consegui obter uma resposta.";
                        document.querySelector(".chat-messages").appendChild(errorMessage);
                        let element = document.getElementsByClassName("chat-messages")[0];
                        element.scrollTop = element.scrollHeight;
                    }
                });
                document.getElementById("input").value = "";
            }
        };
        function displayReponseText(text) {
            let i = 0;
            let lines = text.split('\n').filter(e => e);
            let callback = function() {
                if (i < lines.length) {
                    displayParagraph(lines[i]);
                    i = i + 1;
                    setTimeout(callback, '1000');
                }   
            }
            callback();
        };
        function displayParagraph(text) {
            var botMessage = document.createElement("div");
            botMessage.classList.add("chat-message", "bot-message");
            botMessage.textContent = text;
            document.querySelector(".chat-messages").appendChild(botMessage);
            document.querySelector(".chat-messages").scrollTop = document.querySelector(".chat-messages").scrollHeight;
        };
        document.getElementById("input").addEventListener("keypress", function(event) {
            // If the user presses the "Enter" key on the keyboard
            if (event.key === "Enter" || event.key === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                sendMessage();
            }
        });
    </script>
    <style>
        #chat-popup {
        display: none;
        position: fixed;
        bottom: 0;
        right: 15px;
        z-index: 10;
        }
        /* Button used to open the chat form - fixed at the bottom of the page */
        .open-button {
        background-color: #337ab7;
        color: white;
        padding: 16px 20px;
        border: none;
        cursor: pointer;
        opacity: 0.9;
        position: fixed;
        bottom: 23px;
        right: 28px;
        width: 280px;
        z-index: 10;
        }
        /* Add some hover effects to buttons */
        .form-container .btn:hover, .open-button:hover {
        opacity: 1;
        }
        /* Add a red background color to the cancel button */
        .cancel {
        background-color: #337ab7;
        float: right;
        }

        .chat-container {
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        width: 500px;
        max-width: 100%;
        padding: 20px;
        }

        .chat-header {
        text-align: center;
        margin-bottom: 20px;
        }

        h1 {
        color: #337ab7; /* Azul */
        }

        .chat-messages {
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        }

        .chat-message {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        min-width: 200px;
        }

        .user-message {
        background-color: #e0f2ff; 
        color: #337ab7; /* Azul */
        max-width: 200px;
        display: flex;
        float: right;
        margin-left: 150px;
        }

        .bot-message {
        background-color: #e0e0e0; 
        color: #333;
        float: left;
        margin-right: 150px;
        }

        .chat-input {
        display: flex;
        margin-top: 20px;
        }

        #input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-right: 10px;
        }

        button {
        background-color: #337ab7; 
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        opacity: 0.8;
        }
        /* Add some hover effects to buttons */
        button:hover {
        opacity: 1;
        }

        .typing {
        display: none;
        width: 60px;
        height: 40px;
        display: none;
        justify-content: center;
        align-items: center;
        }
        
        .circle {
        display: block;
        height: 10px;
        width: 10px;
        border-radius: 50%;
        background-color: #8d8d8d;
        margin: 3px;
        } 
        .scaling {
        display: block;
        height: 10px;
        width: 10px;
        border-radius: 50%;
        background-color: #8d8d8d;
        margin: 3px;
        animation: typing 1000ms ease-in-out infinite;
        animation-delay: 3600ms;
        }
        .circle:nth-child(1) {
        animation-delay: 0ms;
        }
        .circle:nth-child(2) {
        animation-delay: 333ms;
        }
        .circle:nth-child(3) {
        animation-delay: 666ms;
        }
        
        @keyframes typing {
        0% { transform: scale(1) }
        33% { transform: scale(1) }
        50% { transform: scale(1.4) } 
        100% { transform: scale(1) }
        }
    </style>
</div>